<!doctype html>
<html>
    <head>
        <title>New York Times Search App</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <style>
            .card {
            margin-bottom: 15px;
          }
          
          input {
            width: 100%;
          }
          
        </style>
    </head>
    <body class="container">
            
         <div class="jumbotron">
            <h1 class="display-4"><i class="far fa-newspaper"></i> The New York Times Search</h1>
        </div>
        
        <div class="card">
            <div class="card-header">Search Parameters</div>
            <div class="card-body">
              <form>
                  <p>Search Term:</p>
                  <input type="text" name="search-term">
                    <br><br>
                  <p>Number of Records to Retrieve:</p>
                  <input type="text" name="records-number">
                    <br><br>
                  <p>Start Year (Optional):</p>
                  <input type="text" name="start-year">
                    <br><br>
                  <p>End Year (Optional):</p>
                  <input type="text" name="end-year">
                    <br>
                    <br>
              </form>
              <button class="btn" id="search"><i class="fas fa-search"></i> Search</button>
              <button class="btn" id="clear-results"><i class="fas fa-trash"></i> Clear Results</button>
                    <br>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Top Articles</div>
            <br><br>
            <div id="search-results"></div>
        </div>
        
        <script>
            $("#clear-results").on("click", function(){
                $("#search-results").empty();
          });
            
          $("#search").on("click", function() {
                $("#search-results").empty();
          
          var apiKey = "18f798304db743d58d1637920c84b86b";
            var queryURL = "https://api.nytimes.com/svc/search/v2/articlesearch.json";
          
          var searchQuery;
          var recordNum = $("records-nubmer").val().trim();
          var starYear;
          var endYear;
          
          queryURL += '?' + $.param({
                    'api-key': apiKey,
            'q': searchQuery,
            
                    });
          
          // Checks if start/end year is filled
          if ($("#start-year").val().trim().length > 0 && $("#end-year").val().trim().length > 0) {
            var temp = queryURL + "?begin_date=" + $("#start-year").val().trim() + "?end_date=" + $("#start-year").val().trim();
            queryURL = temp;
          } else if ($("#start-year").val().trim().length > 0) {
            var temp = queryURL + "?begin_date=" + $("#start-year").val().trim();
            queryURL = temp;
          } else if ($("#end-year").val().trim().length > 0) {
            var temp = queryURL + "?end_date=" + $("#start-year").val().trim();
            queryURL = temp;
          }
          
          
            $.ajax({
                url: queryURL,
                method: "GET"
            })
          
          .then(function(res) {
            for (var i=0; i < recordNum; i++) {
              var card = $("<div>");
              card.attr("class", "card");
              
              $(<div class="card">);
              $(<div class="card-body">).attr("data-number", i);
              $(<h5 class="card-title">).text(res.response.docs.headline.main);
              $(<p class="card-text">).text(res.response.docs.snippet);
              $(<a class="articleLink">).attr("href", res.response.docs.web_url);
              
            }
          });
          
          });
        </script>
    </body>
</html>